import HTML from"./HTML.js";class InputDropDown{constructor(e,t,s,i){this.inputElement=t,this.itemNames=s,this.searchNames=s.map((e=>e.toLowerCase())),this.nameToItemCallback=i,this.itemList=[],this.selectedIndex=-1,this.element=HTML.div(e,"dropdown hidden"),t.addEventListener("input",(()=>this.update())),t.addEventListener("keydown",(e=>this.keyDown(e)))}show(){this.itemList.length>0&&(this.element.className="dropdown")}hide(){this.element.className="dropdown hidden"}isVisible(){return-1===this.element.className.indexOf("hidden")}keyDown(e){if(0!==this.itemList.length){if("ArrowDown"===e.key||"ArrowUp"===e.key)if(e.preventDefault(),this.selectedIndex>-1&&HTML.removeClass(this.itemList[this.selectedIndex].element,"selected"),"ArrowDown"===e.key?++this.selectedIndex:"ArrowUp"===e.key&&--this.selectedIndex,this.selectedIndex>this.itemList.length-1&&(this.selectedIndex=this.itemList.length-1),this.selectedIndex<0)this.selectedIndex=-1;else{const e=this.itemList[this.selectedIndex];HTML.addClass(e.element,"selected"),this.inputElement.value=e.name,this.inputElement.setSelectionRange(e.name.length,e.name.length)}"Escape"===e.key&&this.hide()}else this.selectedIndex=-1}async update(){let e=this.inputElement.value.toLowerCase().trim();if(e.length<2)return void this.hide();const t=this.searchNames.filter((t=>t.indexOf(e)>-1));0!==t.length?(this.show(),this.element.replaceChildren(),this.itemList=[],t.forEach((e=>{const t=this.itemNames[this.searchNames.indexOf(e)],s=this.nameToItemCallback(t),i={name:t,element:s,callback:()=>{this.inputElement.value=t,this.inputElement.focus(),this.hide()}};this.itemList.push(i),s.onclick=i.callback,this.element.appendChild(s)}))):this.hide()}}export default InputDropDown;